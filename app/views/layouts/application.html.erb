<!DOCTYPE html>
<html>
  <head>
    <title><%= @title %></title>
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <%= favicon_link_tag "favicon.png" %>
    <%= csrf_meta_tags %>
    <%= csp_meta_tag %>

    <%= stylesheet_link_tag "application", "data-turbo-track": "reload" %>
    <%= javascript_importmap_tags %>
    <script type="text/javascript" src="https://play.webvideocore.net/js/vapp.js"></script>
    <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/@emailjs/browser@3/dist/email.min.js"></script>
    <% if current_page?(courses_url) %>
      <script>
          // @license magnet:?xt=urn:btih:5ac446d35272cc2e4e85e4325b146d0b7ca8f50c&dn=unlicense.txt Unlicense

          document.addEventListener("turbo:load", () => {
              for (e of document.getElementsByClassName("js-only")) {
                  e.classList.remove("js-only");
              }

              const recipes = document.querySelectorAll("#artlist > div");
              const search = document.getElementById("search");
              const oldheading = document.getElementById("newest-recipes");
              const artlist = document.getElementById("artlist");

              search.addEventListener("input", () => {
                  // grab search input value
                  const searchText = search.value.toLowerCase().trim().normalize('NFD').replace(/\p{Diacritic}/gu, "");
                  const searchTerms = searchText.split(" ");
                  const hasFilter = searchText.length > 0;

                  artlist.classList.toggle("list-searched", hasFilter);
                  oldheading.classList.toggle("hidden", hasFilter);

                  // for each recipe hide all but matched
                  recipes.forEach(recipe => {
                      const searchString = `${recipe.querySelector("p").textContent} ${recipe.dataset.tags}`.toLowerCase().normalize('NFD').replace(/\p{Diacritic}/gu, "");
                      const isMatch = searchTerms.every(term => searchString.includes(term));

                      recipe.hidden = !isMatch;
                      recipe.classList.toggle("matched-recipe", hasFilter && isMatch);
                  })
              })

          })
          // @license-end
      </script>
    <% end %>
  </head>

  <body class="d-flex flex-column" style="padding-top:72px;min-height:100svh">
    <div class="container text-center">
      <%= render 'public/navbar' %>
      <h1><%= @title %></h1>
    </div>
    <div class="container border text-center">
      <div class="row justify-content-center">
        <%= yield %>
      </div>
    </div>
    <div class="wrapper flex-grow-1"></div>
    <div class="container">
      <%= render 'public/footer' %>
    </div>
  </body>
</html>
